<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.58.3" />
    <meta name="description" content="Amazon Lightsail Workshop">
<meta name="author" content="Mike Coleman">

    <link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon" />
<link rel="icon" href="/images/favicon.ico" type="image/x-icon" />
    <title>Lab Guide :: Getting Started with Docker Containers on Amazon Lightsail</title>

    
    <link href="/css/nucleus.css?1579804960" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1579804960" rel="stylesheet">
    <link href="/css/hybrid.css?1579804960" rel="stylesheet">
    <link href="/css/featherlight.min.css?1579804960" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1579804960" rel="stylesheet">
    <link href="/css/auto-complete.css?1579804960" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1579804960" rel="stylesheet">
    <link href="/css/theme.css?1579804960" rel="stylesheet">
    <link href="/css/hugo-theme.css?1579804960" rel="stylesheet">
    
      <link href="/css/theme-mine.css?1579804960" rel="stylesheet">
    

    <script src="/js/jquery-3.3.1.min.js?1579804960"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/lab.html">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a href="/" title="Go home"><svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 30" width="60%" style="padding:20px 0px;"><defs><style>.cls-1{fill:#fff;}.cls-2{fill:#f90;fill-rule:evenodd;}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09,10.85a4.7,4.7,0,0,0,.19,1.48,7.73,7.73,0,0,0,.54,1.19.77.77,0,0,1,.12.38.64.64,0,0,1-.32.49l-1,.7a.83.83,0,0,1-.44.15.69.69,0,0,1-.49-.23,3.8,3.8,0,0,1-.6-.77q-.25-.42-.51-1a6.14,6.14,0,0,1-4.89,2.3,4.54,4.54,0,0,1-3.32-1.19,4.27,4.27,0,0,1-1.22-3.2A4.28,4.28,0,0,1,3.61,7.75,6.06,6.06,0,0,1,7.69,6.46a12.47,12.47,0,0,1,1.76.13q.92.13,1.91.36V5.73a3.65,3.65,0,0,0-.79-2.66A3.81,3.81,0,0,0,7.86,2.3a7.71,7.71,0,0,0-1.79.22,12.78,12.78,0,0,0-1.79.57,4.55,4.55,0,0,1-.58.22l-.26,0q-.35,0-.35-.52V2a1.09,1.09,0,0,1,.12-.58,1.2,1.2,0,0,1,.47-.35A10.88,10.88,0,0,1,5.77.32,10.19,10.19,0,0,1,8.36,0a6,6,0,0,1,4.35,1.35,5.49,5.49,0,0,1,1.38,4.09ZM7.34,13.38a5.36,5.36,0,0,0,1.72-.31A3.63,3.63,0,0,0,10.63,12,2.62,2.62,0,0,0,11.19,11a5.63,5.63,0,0,0,.16-1.44v-.7a14.35,14.35,0,0,0-1.53-.28,12.37,12.37,0,0,0-1.56-.1,3.84,3.84,0,0,0-2.47.67A2.34,2.34,0,0,0,5,11a2.35,2.35,0,0,0,.61,1.76A2.4,2.4,0,0,0,7.34,13.38Zm13.35,1.8a1,1,0,0,1-.64-.16,1.3,1.3,0,0,1-.35-.65L15.81,1.51a3,3,0,0,1-.15-.67.36.36,0,0,1,.41-.41H17.7a1,1,0,0,1,.65.16,1.4,1.4,0,0,1,.33.65l2.79,11,2.59-11A1.17,1.17,0,0,1,24.39.6a1.1,1.1,0,0,1,.67-.16H26.4a1.1,1.1,0,0,1,.67.16,1.17,1.17,0,0,1,.32.65L30,12.39,32.88,1.25A1.39,1.39,0,0,1,33.22.6a1,1,0,0,1,.65-.16h1.54a.36.36,0,0,1,.41.41,1.36,1.36,0,0,1,0,.26,3.64,3.64,0,0,1-.12.41l-4,12.86a1.3,1.3,0,0,1-.35.65,1,1,0,0,1-.64.16H29.25a1,1,0,0,1-.67-.17,1.26,1.26,0,0,1-.32-.67L25.67,3.64,23.11,14.34a1.26,1.26,0,0,1-.32.67,1,1,0,0,1-.67.17Zm21.36.44a11.28,11.28,0,0,1-2.56-.29,7.44,7.44,0,0,1-1.92-.67,1,1,0,0,1-.61-.93v-.84q0-.52.38-.52a.9.9,0,0,1,.31.06l.42.17a8.77,8.77,0,0,0,1.83.58,9.78,9.78,0,0,0,2,.2,4.48,4.48,0,0,0,2.43-.55,1.76,1.76,0,0,0,.86-1.57,1.61,1.61,0,0,0-.45-1.16A4.29,4.29,0,0,0,43,9.22l-2.41-.76A5.15,5.15,0,0,1,38,6.78a3.94,3.94,0,0,1-.83-2.41,3.7,3.7,0,0,1,.45-1.85,4.47,4.47,0,0,1,1.19-1.37A5.27,5.27,0,0,1,40.51.29,7.4,7.4,0,0,1,42.6,0a8.87,8.87,0,0,1,1.12.07q.57.07,1.08.19t.95.26a4.27,4.27,0,0,1,.7.29,1.59,1.59,0,0,1,.49.41.94.94,0,0,1,.15.55v.79q0,.52-.38.52a1.76,1.76,0,0,1-.64-.2,7.74,7.74,0,0,0-3.2-.64,4.37,4.37,0,0,0-2.21.47,1.6,1.6,0,0,0-.79,1.48,1.58,1.58,0,0,0,.49,1.18,4.94,4.94,0,0,0,1.83.92L44.55,7a5.08,5.08,0,0,1,2.57,1.6A3.76,3.76,0,0,1,47.9,11a4.21,4.21,0,0,1-.44,1.93,4.4,4.4,0,0,1-1.21,1.47,5.43,5.43,0,0,1-1.85.93A8.25,8.25,0,0,1,42.05,15.62Z"></path><path class="cls-2" d="M45.19,23.81C39.72,27.85,31.78,30,25,30A36.64,36.64,0,0,1,.22,20.57c-.51-.46-.06-1.09.56-.74A49.78,49.78,0,0,0,25.53,26.4,49.23,49.23,0,0,0,44.4,22.53C45.32,22.14,46.1,23.14,45.19,23.81Z"></path><path class="cls-2" d="M47.47,21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74,3.13-2.2,8.27-1.57,8.86-.83s-.16,5.89-3.09,8.35c-.45.38-.88.18-.68-.32C46.69,25.8,48.17,22.11,47.47,21.21Z"></path></svg></a>

    </div>
    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/introduction.html" title="Introduction" class="dd-item 
        
        
        
        ">
      <a href="/introduction.html">
          Introduction
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/lab.html" title="Lab Guide" class="dd-item 
        parent
        active
        
        ">
      <a href="/lab.html">
          Lab Guide
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    

    
    <section id="footer">
      
<p>
    Questions?<br>
    <a href="http://twitter.com/mikegcoleman/" target="_blank"><i class='fab fa-twitter fa-lg'></i> @mikegcoleman</a>
</p>

<p>
<br>
</p>

<p>
    Get more information on the <a href="https://aws.amazon.com/lightsail">Lightsail home page</a>
</p>

<left>
    <h5 class="copyright">&copy; 2019 Amazon Web Services, Inc. or its Affiliates. All rights reserved.<h5>
</left>
    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            <a href='/'>Amazon Lightsail Workshop</a> > Lab Guide
          
         
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li>
<ul>
<li><a href="#prerequisites">Prerequisites</a></li>
<li><a href="#deploy-your-infrastructure">Deploy your infrastructure</a>
<ul>
<li><a href="#deploy-your-lightsail-instance">Deploy your Lightsail instance</a></li>
<li><a href="#deploy-the-lightsail-database">Deploy the Lightsail database</a></li>
</ul></li>
<li><a href="#install-docker">Install Docker</a></li>
<li><a href="#start-the-web-container">Start the web container</a></li>
<li><a href="#access-the-running-website">Access the running website</a></li>
<li><a href="#attach-the-lightsail-database">Attach the Lightsail database</a></li>
<li><a href="#dealing-with-data-persistence">Dealing with data persistence</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Lab Guide
            </h1>
          

        




	

<h3 id="prerequisites">Prerequisites</h3>

<ul>
<li><p>You will need to have an AWS account with sufficient priviliges to create resources in Amazon Lightsail to complete this lab.</p></li>

<li><p>You should be familiar with using a command line.</p></li>

<li><p>The ability to edit files with a Linux text editor is helpful, but not mandatory</p></li>
</ul>

<h3 id="deploy-your-infrastructure">Deploy your infrastructure</h3>


<div class="notices tip" ><p>Please create all your resources in the <em>Oregon / us-west-2</em> region</p>
</div>


<h4 id="deploy-your-lightsail-instance">Deploy your Lightsail instance</h4>

<p>In this step you&rsquo;ll deploy a Lightsail instance running Ubuntu 18.04</p>

<ul>
<li><p>Log into your AWS account</p></li>

<li><p>Navigate to the <a href="https://lightsail.aws.amazon.com/ls/webapp/home" target="_blank"> Lightsail home page</a></p></li>

<li><p>Close any notifcations that pop up or slide out</p></li>

<li><p>Click <em>Create instance</em></p></li>

<li><p>Scroll down and under <em>Select a blueprint</em> click <em>OS only</em> and select <em>Ubuntu 18.04</em></p>

<p><img src="./images/ubuntu.png?classes=border" alt="" /></p></li>
</ul>


<div class="notices tip" ><p>You can accept the default value for the instance size</p>
</div>


<ul>
<li><p>Scroll down and under <em>Identify your instance</em> enter <em>Docker</em> as the name</p>

<p><img src="./images/instance_name.png?classes=border" alt="" /></p></li>

<li><p>Click <em>Create instance</em></p></li>
</ul>

<h4 id="deploy-the-lightsail-database">Deploy the Lightsail database</h4>

<p>In this section we&rsquo;ll deploy a Lightsail database. Lightsail databases are a managed database service that allow you to get away from the complexity of deploying and managing database software. Lightsail manages the underlying infrastructure and database engine, you only need to worry about creating and deploying the actual databases and tables running inside the service.</p>

<ul>
<li><p>From the <a href="https://lightsail.aws.amazon.com/ls/webapp/home/" target="_blank">Lightsail console home page</a> select <em>Databases</em> from the horizontal menu</p>

<p><img src="../../images/databases-menu.jpg?classes=border" alt="" /></p></li>

<li><p>Click <em>Create database</em></p>

<p><img src="../../images/create-database.jpg?classes=border" alt="" /></p></li>
</ul>


<div class="notices tip" ><p>Make sure you&rsquo;re deploying your database into the same region as your other resources.</p>
</div>


<ul>
<li><p>From the <em>MySQL</em> dropdown choose version <em>5.7.26</em>.</p>

<p><img src="../../images/database_version.jpg?classes=border" alt="" /></p></li>

<li><p>By default Lightsail will create a strong password for you. However this password can contain characters that making copying and pasting difficult, so for this lab we&rsquo;re going to specify a password. To do this first click <em>Specify login credentials</em></p>

<p><img src="../../images/specify_credentials.jpg?classes=border" alt="" /></p></li>

<li><p>Next, uncheck the box next to <em>Create a strong password for me</em> and enter <em>taskstasks</em> for the password.</p>

<p><img src="../../images/password.jpg?classes=border" alt="" /></p></li>

<li><p>Name your database <em>todo-db</em></p>

<p><img src="../../images/name-db.jpg?classes=border" alt="" /></p></li>

<li><p>Click <em>Create database</em></p></li>
</ul>


<div class="notices tip" ><p>It will take several minutes for the creation process to complete, so feel free to move on to the next step while this happens. You&rsquo;ll come back to the Lightsail database later in this session.</p>
</div>


<h3 id="install-docker">Install Docker</h3>

<p>The next step is to install Docker onto your Lightsail instance. You will do this via the Linux command line. To acces the command line, you&rsquo;ll use the built in web-based SSH client.</p>

<ul>
<li><p>Return to the Lightsail console home page</p></li>

<li><p>Click on the console icon on the card for your instance. This will open up a web-based terminal session for that instance</p>

<p><img src="../../images/console_icon.png?classes=border" alt="" /></p></li>

<li><p>The easiest way to install Docker is to simply curl down the installation script from the Docker website. To do that copy and paste the command below into your terminal window</p>

<pre><code>curl -sSL https://get.docker.com | sh
</code></pre>

<p>You should see a lot of output in the terminal window with the final text being a warning about adding a user to the Docker group granting the ability to run containers that can obtain root priviliges. Since this is just a lab environment, it&rsquo;s safe to ignore this warning.</p></li>

<li><p>Issue the following command to add the <em>ubuntu</em> user to the <em>docker</em> group</p>

<pre><code>sudo usermod -aG docker ubuntu
</code></pre></li>

<li><p>You need to close down the terminal window and log back in for this last step to take effect. Enter <em>exit</em> into the terminal then click the <em>Reconnect</em> button</p></li>

<li><p>To ensure Docker is properly installed issue the following command. This command will pull down a container image from Docker Hub and run a &ldquo;hello world&rdquo; program.</p>

<pre><code>docker run hello-world
</code></pre>

<p>The message should indicate that everything is working properly</p>

<pre><code>Hello from Docker!
This message shows that your installation appears to be working correctly.
</code></pre></li>
</ul>

<h3 id="start-the-web-container">Start the web container</h3>

<p>In the last step we ran a simple Docker container based on a prepackaged <a href="https://docs.docker.com/engine/reference/commandline/images/" target="_blank">Docker image</a>. Docker images are compiled files that can be instantiated into running programs. There are thousands of prepackaged images on <a href="https://hub.docker.com/search?q=&type=image" target="_blank">Docker hub</a> or you can build your own from scratch.</p>

<p>For this session we&rsquo;ll be using a prepackaged Docker image as covering the process of building Docker images is out of scope.</p>

<ul>
<li><p>Issue the <code>docker run</code> command to start the web front end</p>

<pre><code>docker run -d -p 80:80 --name web mikegcoleman/todo-php:reinvent
</code></pre>

<ul>
<li><em>-d</em>  starts the container in the background (detached mode)</li>
<li><em>-p</em> insructs Docker to route any connections coming into the Lightsail instance on port 80 to be routed to the docker container on the same port</li>
<li><em>&ndash;name</em> provides a friendly name for the container
<br /></li>
</ul>

<p>If the container started successfully you should see the container ID displayed</p>

<pre><code>a1e4d7d02f0f9f9017fa22b007a5deaaf95c71395458c0f9dbd8ee02b309e4c
</code></pre></li>
</ul>


<div class="notices tip" ><p>Your container ID will be different the one displayed above is for illustration purposes only</p>
</div>


<h3 id="access-the-running-website">Access the running website</h3>

<p>You should now be able to access your running website. To do so navigate to the IP address of your Lightsail instance. You can find the IP address of your Lightsail instance in the botton right hand corner of your instance card.</p>

<p><img src="../../images/ip_address.png?classes=border" alt="" /></p>

<p>If the application is running you&rsquo;ll see a website like the one below.</p>

<p><img src="../../images/website.png?classes=border" alt="" /></p>


<div class="notices tip" ><p>The application is running, but it&rsquo;s not configured correctly as it cannot find the database. You&rsquo;ll fix this error in the next section</p>
</div>



<div class="notices tip" ><p>Notice that the Front-end host displayed at the bottom of the screen matches the first part of your container ID.</p>
</div>


<h3 id="attach-the-lightsail-database">Attach the Lightsail database</h3>

<p>In order to the connect to the Lightsail database you&rsquo;ll need to have database endpoint, user name, and password.</p>

<ul>
<li><p>Return to the database section of the Lightsail console, and click on the name of your database</p></li>

<li><p>Under <em>Connection details</em> click on <em>Show</em> to display the password</p>

<p><img src="../../images/connection_details.png?classes=border" alt="" /></p></li>

<li><p>Navigate back to the website and click on settings</p>

<p><img src="../../images/settings.png?classes=border" alt="" /></p></li>

<li><p>Fill in the details on the setting page with the values found under the <em>Connections details</em> section for your database</p></li>

<li><p>Click <em>Add Task</em> from the website menu and enter a task</p></li>

<li><p>Click <em>Add Task</em> to save the task to the database</p></li>
</ul>

<p>The containerized web application is now saving the task data into the Lightsail database.</p>


<div class="notices tip" ><p>Notice that the Database host displayed at the bottom of the screen matches the endpoint value for your Lightsail database.</p>
</div>


<h3 id="dealing-with-data-persistence">Dealing with data persistence</h3>

<p>One of the issues with containers is that they are ephemeral, meaning that any data saved in the container is lost if the container is restarted. In the case of the Todo application it saves the information for the database connection in a file.</p>

<ul>
<li><p>Stop the running container</p>

<pre><code>docker stop web
</code></pre></li>

<li><p>Remove the running container</p>

<pre><code>docker rm web
</code></pre></li>

<li><p>Restart the container</p>

<pre><code>docker run -d -p 80:80 --name web mikegcoleman/todo-php:reinvent
</code></pre></li>

<li><p>Go back to your web browser, and reload the Todo application. Notice that it once again cannot find the database connection.</p></li>
</ul>

<p>There are a couple of ways of dealing with this issue. You could refactor the application to use environment variables, which can be passed when you start the container. You could also use a secrets manager to securely store the connection information.</p>

<p>The other way to handle the issue is to instruct Docker to remap the file from the container file system to the host&rsquo;s file system. With this approach, any information written to the file will persist even if the container is removed.</p>

<ul>
<li><p>Stop the running container</p>

<pre><code>docker stop web
</code></pre></li>

<li><p>Remove the running container</p>

<pre><code>docker rm web
</code></pre></li>

<li><p>Create a local copy of the configuration file by cloning down the git repo and moving the <em>connectvalues.php</em> file into the home directory (issue each command below one by one)</p>

<pre><code>cd ~

git clone -b loft https://github.com/mikegcoleman/todo-php

mv /home/ubuntu/todo-php/connectvalues.php .
</code></pre></li>

<li><p>Ensure the permissions on the file are correct (they need to be set to represent the container&rsquo;s user account)</p>

<pre><code>sudo chown www-data:www-data /home/ubuntu/connectvalues.php 
</code></pre></li>

<li><p>Restart the container using the <code>-v</code> switch and the instruct Docker to remap the container&rsquo;s configuration file to the one on the local host.</p>

<pre><code>docker run -d -p 80:80 --name web -v ~/connectvalues.php:/var/www/html/connectvalues.php mikegcoleman/todo-php:reinvent
</code></pre></li>

<li><p>Follow the steps in the  <em>Attach the Lightsail database</em> section to specify the database connection information</p></li>

<li><p>Go back to the web browser and reload the site, notice that the data you entered previously is now being retrieved from the database</p></li>

<li><p>Now go ahead and stop the container, remove it, and restart it</p>

<pre><code>docker stop web

docker rm web

docker run -d -p 80:80 --name web -v ~/connectvalues.php:/var/www/html/connectvalues.php mikegcoleman/todo-php:reinvent
</code></pre></li>

<li><p>Reload the Todo website, and notice that this time after deleting and starting a new container the configuration information was persisted.</p></li>

<li><p>If you look at the contents of the file on your host machine you can see it contains the connection values for your Lightsail database</p>

<pre><code>cat /home/ubuntu/connectvalues.php
</code></pre></li>
</ul>





<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/introduction.html" title="Introduction"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/introduction.html" title="Introduction" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1579804960"></script>
    <script src="/js/perfect-scrollbar.min.js?1579804960"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1579804960"></script>
    <script src="/js/jquery.sticky.js?1579804960"></script>
    <script src="/js/featherlight.min.js?1579804960"></script>
    <script src="/js/highlight.pack.js?1579804960"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1579804960"></script>
    <script src="/js/learn.js?1579804960"></script>
    <script src="/js/hugo-learn.js?1579804960"></script>

    <link href="/mermaid/mermaid.css?1579804960" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1579804960"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    

  </body>
</html>
